<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard — Genda</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0D7377">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Genda">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
</head>
<body>
<aside class="sidebar">
  <div class="sb-logo"><div class="l">G</div><span class="w">Genda</span><span class="plan" id="planBadge">FREE</span></div>
  <nav class="sb-nav">
    <a class="ni active" href="#" data-section="home"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg></span><span>Dashboard</span></a>
    <div class="sb-label">Planning</div>
    <a class="ni" href="#" data-section="bookings"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span><span>Agenda</span></a>
    <a class="ni" href="#" data-section="clients"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span><span id="sbClientsLabel">Clients</span></a>
    <a class="ni" href="#" data-section="services"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg></span><span id="sbServicesLabel">Prestations</span></a>
    <a class="ni" href="#" data-section="hours"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span><span>Disponibilités</span></a>
    <a class="ni" href="#" data-section="waitlist"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg></span><span>Liste d'attente</span></a>
    <a class="ni" href="#" data-section="cal-sync"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4m8-4v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z"/><path d="M16 14l-4 4-4-4"/></svg></span><span>Cal. externe</span></a>
    <div class="sb-label" id="sbBizName">Cabinet</div>
    <a class="ni" href="#" data-section="team"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span><span>Équipe</span></a>
    <a class="ni" href="#" data-section="site"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></span><span>Mon site</span></a>
    <a class="ni" href="#" data-section="calls"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg></span><span>Appels</span></a>
    <div class="sb-label">Admin</div>
    <a class="ni" href="#" data-section="invoices"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 17.5v-11"/></svg></span><span>Facturation</span></a>
    <a class="ni" href="#" data-section="deposits"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></span><span>Acomptes</span></a>
    <a class="ni" href="#" data-section="documents"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span><span>Documents</span></a>
    <a class="ni" href="#" data-section="analytics"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></span><span>Statistiques</span></a>
    <a class="ni" href="#" data-section="settings"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span><span>Paramètres</span></a>
    <a class="ni" href="#" data-section="profile"><span class="ic"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span><span>Mon profil</span></a>
  </nav>
  <div class="sb-foot">
    <div class="nm" id="userName">—</div>
    <div class="rl" id="userRole">—</div>
    <div class="logout" onclick="doLogout()">Déconnexion</div>
  </div>
</aside>
<div class="main">
  <div class="topbar"><h1 id="pageTitle">Dashboard</h1><div><span style="font-size:.78rem;color:var(--text-4)" id="todayDate"></span></div></div>
  <div class="content" id="contentArea"><div class="loading"><div class="spinner"></div><p style="margin-top:10px">Chargement...</p></div></div>
</div>
<!-- CALENDAR DETAIL MODAL -->
<div class="cal-modal-overlay" id="calDetailModal">
  <div class="cal-modal">
    <div class="m-header">
      <div class="m-header-bg" id="mHeaderBg"></div>
      <button class="m-close" onclick="closeCalModal('calDetailModal')"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <div class="m-header-content">
        <div class="m-client-hero" id="mClientHero"></div>
      </div>
    </div>
    <div class="m-status-strip" id="mStatusStrip"></div>
    <div class="m-tabs">
      <div class="m-tab active" data-tab="rdv" onclick="switchCalTab(this,'rdv')">RDV</div>
      <div class="m-tab" data-tab="notes" onclick="switchCalTab(this,'notes')">Notes<span class="tab-count" id="mCountNotes" style="display:none"></span></div>
      <div class="m-tab" data-tab="todos" onclick="switchCalTab(this,'todos')">Tâches<span class="tab-count" id="mCountTodos" style="display:none"></span></div>
      <div class="m-tab" data-tab="reminders" onclick="switchCalTab(this,'reminders')">Rappels</div>
      <div class="m-tab" data-tab="docs" onclick="switchCalTab(this,'docs')">Docs<span class="tab-count" id="mCountDocs" style="display:none"></span></div>
    </div>
    <div class="cal-modal-body">
      <div class="cal-panel active" id="calPanelRdv">
        <div class="m-svc-card" id="mSvcCard" style="display:none"></div>
        <div class="m-free-card" id="mFreeCard" style="display:none">
          <div style="flex:1;min-width:0">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
              <span class="m-free-badge"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg> LIBRE</span>
              <input class="m-free-title" id="uFreeLabel" placeholder="Intitulé du RDV...">
            </div>
            <div id="uFreeColorWrap"></div>
          </div>
        </div>
        <div id="mGroupSiblings" style="display:none"></div>
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Horaire</span><span class="m-sec-line"></span></div>
          <div class="m-row m-row-3">
            <div><div class="m-field-label">Date</div><input type="date" class="m-input" id="calEditDate" onchange="fcUpdateEditDiff();calCheckConflict()"></div>
            <div><div class="m-field-label">Début</div><input type="time" class="m-input" id="calEditStart" onchange="fcUpdateEditDiff();calCheckConflict()"></div>
            <div><div class="m-field-label">Fin</div><input type="time" class="m-input" id="calEditEnd" onchange="fcUpdateEditDiff();calCheckConflict()"></div>
          </div>
          <div class="m-chips" id="calDurChips">
            <span class="m-chip" onclick="calSetDuration(15,this)">15</span>
            <span class="m-chip" onclick="calSetDuration(30,this)">30</span>
            <span class="m-chip" onclick="calSetDuration(45,this)">45</span>
            <span class="m-chip" onclick="calSetDuration(60,this)">1h</span>
            <span class="m-chip" onclick="calSetDuration(90,this)">1h30</span>
            <span class="m-chip" onclick="calSetDuration(120,this)">2h</span>
          </div>
          <div id="calConflictWarn" style="display:none;margin-top:8px;padding:8px 12px;border-radius:8px;font-size:.78rem;line-height:1.4;animation:fadeIn .2s"></div>
        </div>
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> <span class="lbl-practitioner">Praticien</span></span><span class="m-sec-line"></span></div>
          <div class="m-prac-wrap">
            <span class="m-prac-dot" id="mPracDot"></span>
            <select class="m-input" id="uPracSelect"></select>
          </div>
        </div>
        <div class="m-sec" id="mBufferSec" style="display:none">
          <div class="m-sec-head"><span class="m-sec-title">⏸ Buffers</span><span class="m-sec-line"></span></div>
          <div class="m-row m-row-2">
            <div><div class="m-field-label">Avant (min)</div><input class="m-input" type="number" id="uBufBefore" value="0" min="0" step="5"></div>
            <div><div class="m-field-label">Après (min)</div><input class="m-input" type="number" id="uBufAfter" value="0" min="0" step="5"></div>
          </div>
        </div>
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg> Commentaire</span><span class="m-sec-line"></span></div>
          <textarea class="m-input" id="uComment" rows="2" placeholder="Ajouter un commentaire..." style="resize:vertical"></textarea>
        </div>
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg> Note interne</span><span class="m-sec-line"></span></div>
          <textarea class="m-input m-input-note" id="calIntNote" rows="2" placeholder="Note visible uniquement par l'équipe..." style="resize:vertical"></textarea>
        </div>
        <div id="calEditDiff" style="display:none;margin:8px 0"></div>
        <div class="notify-panel" id="calNotifyPanel">
          <h4><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg> Notifier ?</h4>
          <div class="notify-options">
            <div class="notify-opt" onclick="calSelectNotify('email',this)"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>Email</div>
            <div class="notify-opt" onclick="calSelectNotify('sms',this)"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>SMS</div>
            <div class="notify-opt" onclick="calSelectNotify('both',this)"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>Les deux</div>
            <div class="notify-opt" onclick="calSelectNotify('none',this)"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Non</div>
          </div>
          <div class="notify-actions"><button class="cal-btn" onclick="calCloseNotify()">Terminé</button><button class="cal-btn cal-green" id="calSendNotifyBtn" onclick="calSendNotification()" style="display:none">Envoyer</button></div>
        </div>
        <div class="m-bottom" id="mBottom">
          <button class="m-btn m-btn-primary" id="mBtnSave" onclick="calSaveAll()">Enregistrer</button>
          <button class="m-btn m-btn-ghost" id="mBtnNotify" onclick="document.getElementById('calNotifyPanel').style.display='block';document.getElementById('calNotifyPanel').scrollIntoView({behavior:'smooth',block:'nearest'})">Notifier</button>
          <button class="m-btn m-btn-danger" id="mBtnCancel" onclick="fcSetStatus('cancelled')">Annuler le RDV</button>
          <button class="m-btn m-btn-danger" id="mBtnPurge" onclick="fcPurgeBooking()" style="display:none"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg> Supprimer définitivement</button>
        </div>
      </div>
      <div class="cal-panel" id="calPanelNotes">
        <div id="calNoteList"></div>
        <div class="add-note">
          <textarea id="calNewNote" placeholder="Ajouter une note..."></textarea>
          <div class="add-note-actions">
            <label style="font-size:.72rem;color:var(--text-4);display:flex;align-items:center;gap:4px"><input type="checkbox" id="calNotePinned"> Épinglée</label>
            <button class="cal-btn primary" onclick="calAddNote()" style="padding:6px 14px;font-size:.78rem">Ajouter</button>
          </div>
        </div>
      </div>
      <div class="cal-panel" id="calPanelTodos">
        <div id="calTodoList"></div>
        <div class="add-todo">
          <input id="calNewTodo" placeholder="Nouvelle tâche..." onkeydown="if(event.key==='Enter')calAddTodo()">
          <button class="cal-btn primary" onclick="calAddTodo()" style="padding:6px 14px;font-size:.78rem">+</button>
        </div>
      </div>
      <div class="cal-panel" id="calPanelReminders">
        <div id="calReminderList"></div>
        <div class="add-reminder">
          <select id="calReminderOffset">
            <option value="15">15 min avant</option>
            <option value="30" selected>30 min avant</option>
            <option value="60">1 heure avant</option>
            <option value="120">2 heures avant</option>
            <option value="1440">La veille</option>
          </select>
          <select id="calReminderChannel">
            <option value="browser">Notif</option>
            <option value="email">Email</option>
            <option value="both">Les deux</option>
          </select>
          <button class="cal-btn primary" onclick="calAddReminder()" style="padding:6px 14px;font-size:.78rem">Ajouter</button>
        </div>
      </div>
      <div class="cal-panel" id="calPanelDocs">
        <div id="mDocsList"></div>
        <div id="mDocsSend" style="margin-top:12px"></div>
      </div>
    </div>
  </div>
</div>

<!-- QUICK CREATE MODAL — same structure as Detail -->
<div class="cal-modal-overlay" id="calCreateModal">
  <div class="cal-modal">
    <div class="m-header">
      <div class="m-header-bg" id="qcHeaderBg" style="background:linear-gradient(135deg,var(--primary) 0%,var(--primary)AA 60%,var(--primary)55 100%)"></div>
      <button class="m-close" onclick="closeCalModal('calCreateModal')"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <div class="m-header-content">
        <div style="display:flex;align-items:flex-end;gap:14px;margin-bottom:16px">
          <div class="m-avatar" id="qcAvatar" style="background:linear-gradient(135deg,var(--primary),var(--primary)CC)"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width:22px;height:22px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg></div>
          <div style="flex:1;min-width:0">
            <div class="m-client-name" style="font-size:1.15rem">Nouveau rendez-vous</div>
          </div>
        </div>
      </div>
    </div>
    <div class="m-tabs">
      <div class="m-tab active" data-tab="qc-rdv" onclick="qcSwitchTab(this,'qc-rdv')">RDV</div>
      <div class="m-tab" data-tab="qc-notes" onclick="qcSwitchTab(this,'qc-notes')">Notes<span class="tab-count" id="qcCountNotes" style="display:none"></span></div>
      <div class="m-tab" data-tab="qc-todos" onclick="qcSwitchTab(this,'qc-todos')">Tâches<span class="tab-count" id="qcCountTodos" style="display:none"></span></div>
      <div class="m-tab" data-tab="qc-reminders" onclick="qcSwitchTab(this,'qc-reminders')">Rappels<span class="tab-count" id="qcCountReminders" style="display:none"></span></div>
    </div>
    <div class="cal-modal-body">
      <!-- TAB: RDV -->
      <div class="cal-panel active" id="qcPanelRdv">
        <!-- Client -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> <span class="lbl-client">Client</span></span><span class="m-sec-line"></span></div>
          <div style="position:relative">
            <input class="m-input" id="qcClient" placeholder="Rechercher un client..." autocomplete="off" oninput="calSearchClients(this.value)">
            <div id="qcAcResults" class="ac-results" style="display:none"></div>
            <input type="hidden" id="qcClientId">
          </div>
          <div id="qcClientDetails" style="display:none;margin-top:8px">
            <div class="m-row m-row-2">
              <div><div class="m-field-label">Email</div><input class="m-input" type="email" id="qcClientEmail" placeholder="email@exemple.com"></div>
              <div><div class="m-field-label">T\u00e9l\u00e9phone</div><input class="m-input" type="tel" id="qcClientPhone" placeholder="+32 ..."></div>
            </div>
          </div>
        </div>
        <!-- Prestation -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg> <span class="lbl-service">Prestation</span></span><span class="m-sec-line"></span></div>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:.75rem;font-weight:600;color:var(--text-3);margin-bottom:8px">
            <input type="checkbox" id="qcFreestyle" onchange="qcToggleFreestyle()" style="accent-color:var(--primary);width:15px;height:15px"> Mode libre <span style="font-weight:400;color:var(--text-4)">(sans prestation)</span>
          </label>
          <div id="qcNormalMode">
            <div id="qcServiceList"></div>
            <button class="cal-btn" style="margin-top:6px;font-size:.75rem;padding:5px 12px" onclick="qcAddService()" id="qcAddSvcBtn">+ Ajouter une prestation</button>
            <div id="qcTotalDuration" style="font-size:.72rem;color:var(--text-4);margin-top:6px"></div>
          </div>
          <div id="qcFreestyleMode" style="display:none">
            <div style="margin-bottom:8px"><div class="m-field-label">Intitulé du RDV</div><input class="m-input" id="qcFreeLabel" placeholder="ex: Urgence dossier Martin..."></div>
            <div><div class="m-field-label">Couleur</div><div id="qcFreeColorWrap"></div></div>
          </div>
        </div>
        <!-- Horaire -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Horaire</span><span class="m-sec-line"></span></div>
          <div class="m-row m-row-3">
            <div><div class="m-field-label">Date</div><input type="date" class="m-input" id="qcDate"></div>
            <div><div class="m-field-label">Début</div><input type="time" class="m-input" id="qcTime" value="09:00"></div>
            <div id="qcEndTimeWrap" style="display:none"><div class="m-field-label">Fin</div><input type="time" class="m-input" id="qcFreeEnd" value="10:00"></div>
          </div>
          <div class="m-row m-row-2" id="qcBufferRow" style="display:none;margin-top:8px">
            <div><div class="m-field-label">Buffer avant (min)</div><input class="m-input" type="number" id="qcFreeBufBefore" value="0" min="0" step="5"></div>
            <div><div class="m-field-label">Buffer après (min)</div><input class="m-input" type="number" id="qcFreeBufAfter" value="0" min="0" step="5"></div>
          </div>
          <div id="qcFreeDuration" style="font-size:.72rem;color:var(--text-4);margin-top:4px;display:none"></div>
        </div>
        <!-- Praticien -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> <span class="lbl-practitioner">Praticien</span></span><span class="m-sec-line"></span></div>
          <div class="m-prac-wrap">
            <span class="m-prac-dot" id="qcPracDot"></span>
            <select class="m-input" id="qcPrac"></select>
          </div>
        </div>
        <!-- Mode -->
        <div class="m-sec" id="qcModeRow">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M9 22v-4h6v4"/></svg> Mode</span><span class="m-sec-line"></span></div>
          <select class="m-input" id="qcMode"><option value="cabinet">Cabinet</option></select>
        </div>
        <!-- Commentaire -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg> Commentaire</span><span class="m-sec-line"></span></div>
          <textarea class="m-input" id="qcComment" rows="2" placeholder="Ajouter un commentaire..." style="resize:vertical"></textarea>
        </div>
        <!-- Note interne -->
        <div class="m-sec">
          <div class="m-sec-head"><span class="m-sec-title"><svg class="gi" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg> Note interne</span><span class="m-sec-line"></span></div>
          <textarea class="m-input m-input-note" id="qcIntNote" rows="2" placeholder="Note visible uniquement par l'équipe..." style="resize:vertical"></textarea>
        </div>
        <!-- Bottom -->
        <div class="m-bottom">
          <button class="m-btn m-btn-primary" id="qcBtnCreate" onclick="calCreateBooking()">Créer le RDV</button>
          <button class="m-btn m-btn-ghost" onclick="closeCalModal('calCreateModal')">Annuler</button>
        </div>
      </div>
      <!-- TAB: Notes -->
      <div class="cal-panel" id="qcPanelNotes">
        <div id="qcNoteList"></div>
        <div class="add-note">
          <textarea id="qcNewNote" placeholder="Ajouter une note..."></textarea>
          <div class="add-note-actions">
            <label style="font-size:.72rem;color:var(--text-4);display:flex;align-items:center;gap:4px"><input type="checkbox" id="qcNotePinned"> Épinglée</label>
            <button class="cal-btn primary" onclick="qcAddNote()" style="padding:6px 14px;font-size:.78rem">Ajouter</button>
          </div>
        </div>
      </div>
      <!-- TAB: Tâches -->
      <div class="cal-panel" id="qcPanelTodos">
        <div id="qcTodoList"></div>
        <div class="add-todo">
          <input id="qcNewTodo" placeholder="Nouvelle tâche..." onkeydown="if(event.key==='Enter')qcAddTodo()">
          <button class="cal-btn primary" onclick="qcAddTodo()" style="padding:6px 14px;font-size:.78rem">+</button>
        </div>
      </div>
      <!-- TAB: Rappels -->
      <div class="cal-panel" id="qcPanelReminders">
        <div id="qcReminderList"></div>
        <div class="add-reminder">
          <select id="qcReminderOffset">
            <option value="15">15 min avant</option>
            <option value="30" selected>30 min avant</option>
            <option value="60">1 heure avant</option>
            <option value="120">2 heures avant</option>
            <option value="1440">La veille</option>
          </select>
          <select id="qcReminderChannel">
            <option value="browser">Notif</option>
            <option value="email">Email</option>
            <option value="both">Les deux</option>
          </select>
          <button class="cal-btn primary" onclick="qcAddReminder()" style="padding:6px 14px;font-size:.78rem">Ajouter</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="gToast" class="g-toast" style="display:none"></div>

<!-- Vite entry point -->
<script type="module" src="/src/frontend/main.js"></script>
</body>
</html>
